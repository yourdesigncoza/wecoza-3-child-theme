# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Theme Overview

This is the WeCoza 3 Child Theme, a WordPress child theme built on Bootscore (Bootstrap 5). The theme follows an MVC architecture pattern and is being progressively migrated from legacy code to modern patterns.

## Critical Development Rules

### CSS Styling
- **ALL CSS must be added to**: `/includes/css/ydcoza-styles.css`
- Never create separate CSS files in plugin directories or elsewhere
- Always append new styles to the existing ydcoza-styles.css file

### Git Workflow
- Use feature branches: `feature/WEC-[ticket]-description`
- Commit messages should use: "Generated by John @ YourDesign.co.za"
- Track development in `@wecoza-dev-flow/tracking/` directory

## Common Development Commands

```bash
# Package theme for distribution (removes dev files)
./package-theme.sh

# View theme structure
tree -I 'node_modules|vendor|.git'

# Test individual components
php test-shortcode-list.php
```

## Architecture Overview

### MVC Structure
```
app/
├── Controllers/    # Request/response handling
├── Models/        # Data structures and business logic  
├── Services/      # Business logic services
├── Views/         # Presentation templates
├── Helpers/       # Utility functions
└── bootstrap.php  # MVC initialization
```

### Key Files
- `functions.php` - Theme initialization and asset loading
- `app/bootstrap.php` - MVC framework bootstrapping
- `config/app.php` - Application configuration
- `includes/css/ydcoza-styles.css` - ALL custom CSS goes here

### Legacy Migration
The `assets/` directory contains legacy functionality being migrated to MVC:
- `agents/` - Agent management (legacy)
- `clients/` - Client management (legacy)
- `learners/` - Learner management (legacy)

## Database Access

The theme supports both MySQL and PostgreSQL:
- Database configuration is pulled from WordPress constants
- Uses PDO for database abstraction
- Connection details in `config/app.php`

## Shortcode Development

Shortcodes are organized in `includes/shortcodes/`:
1. Create new file following naming convention: `wecoza-[feature]-shortcode.php`
2. Register in `includes/functions/shortcodes.php`
3. Document in `docs/shortcodes/`
4. Add to shortcode list in `includes/shortcodes/wecoza-shortcode-list.php`

Example shortcode structure:
```php
add_shortcode('wecoza_feature', 'wecoza_feature_callback');
function wecoza_feature_callback($atts) {
    $atts = shortcode_atts([
        'param' => 'default'
    ], $atts);
    
    ob_start();
    // Implementation
    return ob_get_clean();
}
```

## AJAX Implementation

AJAX handlers are centralized in `app/ajax-handlers.php`:
```javascript
// Frontend JS
jQuery.post(wecoza_ajax.ajax_url, {
    action: 'wecoza_action',
    nonce: wecoza_ajax.nonce,
    data: data
});
```

## Theme Features

### Bootstrap Integration
- Bootstrap 5 with Phoenix theme components
- Custom sidebar walker: `app/Walkers/BootstrapSidebarNavWalker.php`
- Responsive utilities and components

### Dark/Light Theme Toggle
- Managed via localStorage
- Toggle in header navigation
- CSS variables for theme colors

### File Upload Service
- Service: `app/Services/FileUploadService.php`
- Handles validation and security
- Configurable upload directories

## Important Notes

1. **Class functionality has been extracted** to a separate WeCoza Classes Plugin
2. **Namespace conflicts** were resolved during the extraction
3. **Test files** like `test-shortcode-list.php` are for development only
4. **Legacy code** in `assets/` should not be modified unless migrating to MVC

## Development Best Practices

1. Follow DRY principles - extract repeated code into helpers
2. Use MVC patterns for new features
3. Validate and sanitize all user inputs
4. Use WordPress coding standards
5. Document new shortcodes in the shortcode list
6. Test components individually before integration

## Quick Reference

- Parent Theme: Bootscore
- PHP Version: 8.0+
- WordPress Version: 6.0+
- Database: MySQL 5.7+ or PostgreSQL 12+
- CSS Framework: Bootstrap 5
- Icons: Line Icons font

## Common Tasks

### Adding a New Shortcode
1. Create file in `includes/shortcodes/`
2. Register in `includes/functions/shortcodes.php`
3. Update shortcode list
4. Document usage

### Adding New CSS
1. Open `/includes/css/ydcoza-styles.css`
2. Add styles at the end of the file
3. Use descriptive comments for sections

### Creating a New Controller
1. Create class in `app/Controllers/`
2. Register in `config/app.php`
3. Follow existing controller patterns

### Database Queries
Use the Database service for consistency:
```php
$db = new \App\Services\Database();
$results = $db->query("SELECT * FROM table WHERE id = ?", [$id]);
```